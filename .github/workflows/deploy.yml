name: ğŸš€ Deploy to Timeweb

on:
  # Ğ”ĞµĞ¿Ğ»Ğ¾Ğ¹ Ğ¿Ñ€Ğ¸ Ğ¿ÑƒÑˆĞµ Ğ² main
  push:
    branches: [ main, master ]
    paths:
      - 'ab-test-generator.html'
      - '.github/workflows/deploy.yml'

  # Ğ ÑƒÑ‡Ğ½Ğ¾Ğ¹ Ğ´ĞµĞ¿Ğ»Ğ¾Ğ¹ (Ğ²Ñ‹ ÑĞ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ½Ğ°Ğ¶Ğ°Ñ‚ÑŒ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ Ğ² GitHub)
  workflow_dispatch:

jobs:
  deploy:
    name: ğŸ“¦ Deploy to Production
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ”‘ Setup SSH
        run: |
          mkdir -p ~/.ssh
          echo "${{ secrets.SSH_PRIVATE_KEY }}" > ~/.ssh/id_rsa
          chmod 600 ~/.ssh/id_rsa
          ssh-keyscan -H ${{ secrets.SSH_HOST }} >> ~/.ssh/known_hosts

      - name: ğŸš€ Deploy to Timeweb
        run: |
          echo "Deploying to ${{ secrets.SSH_HOST }}..."
          scp -P ${{ secrets.SSH_PORT }} ab-test-generator.html ${{ secrets.SSH_USER }}@${{ secrets.SSH_HOST }}:${{ secrets.REMOTE_PATH }}/ab-test-generator.html
          echo "âœ… Deploy successful!"

      - name: âœ… Verify deployment
        run: |
          ssh -p ${{ secrets.SSH_PORT }} ${{ secrets.SSH_USER }}@${{ secrets.SSH_HOST }} "ls -lh ${{ secrets.REMOTE_PATH }}/ab-test-generator.html"
          echo "File is live at: https://${{ secrets.SSH_HOST }}/ab-test-generator.html"

      - name: ğŸ“¢ Notify
        if: success()
        run: |
          echo "ğŸ‰ Deployment completed successfully!"
          echo "ğŸŒ URL: https://${{ secrets.SSH_HOST }}/ab-test-generator.html"
